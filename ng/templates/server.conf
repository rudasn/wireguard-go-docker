server {
    # include /etc/ng/conf.d/server.geo.check.conf;
    include /etc/ng/conf.d/server.error.pages.conf;

    underscores_in_headers on;

    {{- if has . "server_name" }}
    server_name {{ .server_name }};
    {{- end }}

    {{ if test.IsKind "string" .listen }}
    listen {{ .listen }};
    {{ else }}
    {{ range .listen }}
    listen {{ . }};
    {{ end }}
    {{ end }}

    {{ if has . "certbot" }}
        {{ if test.IsKind "string" .certbot }}
            {{ template "/etc/ng/templates/certbot.conf" .certbot }}
        {{ else }}
            {{ if test.IsKind "slice" .certbot }}
            {{ range .certbot }}
            {{ template "/etc/ng/templates/certbot.conf" . }}
            {{ end }}
            {{ else }}
            {{ if test.IsKind "bool" .certbot }}
            {{ template "/etc/ng/templates/certbot.conf" .server_name }}
            {{ end }}
            {{ end }}
        {{ end }}
    {{ end }}

    {{- if has . "set_real_ip_from" }}
    set_real_ip_from {{ .set_real_ip_from }};
    real_ip_recursive on;
    real_ip_header X-Forwarded-For;
    {{- end }}

    {{- if has . "root" }}
    # public root directory
    root {{ .root }};
    {{- end }}

    {{- if has . "access" }}
    {{ template "/etc/ng/templates/access.conf" .access }}
    {{- end }}

    {{- if has . "location" }}
    {{ range .location }}
    {{ template "/etc/ng/templates/location.conf" . }}
    {{ end }}
    {{- end }}
}
